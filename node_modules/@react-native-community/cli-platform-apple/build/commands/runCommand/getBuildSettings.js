"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getBuildSettings = getBuildSettings;
function _cliTools() {
  const data = require("@react-native-community/cli-tools");
  _cliTools = function () {
    return data;
  };
  return data;
}
function _picocolors() {
  const data = _interopRequireDefault(require("picocolors"));
  _picocolors = function () {
    return data;
  };
  return data;
}
function _child_process() {
  const data = _interopRequireDefault(require("child_process"));
  _child_process = function () {
    return data;
  };
  return data;
}
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
async function getBuildSettings(xcodeProject, mode, buildOutput, scheme, target) {
  const buildSettings = _child_process().default.execFileSync('xcodebuild', [xcodeProject.isWorkspace ? '-workspace' : '-project', xcodeProject.name, '-scheme', scheme, '-sdk', getPlatformName(buildOutput), '-configuration', mode, '-showBuildSettings', '-json'], {
    encoding: 'utf8'
  });
  const settings = JSON.parse(buildSettings);

  // Find all 'app' targets in the build settings
  const applicationTargets = settings.filter(setting => setting.buildSettings.WRAPPER_EXTENSION === 'app').map(({
    target: settingsTarget
  }) => settingsTarget);
  if (applicationTargets.length === 0) return null;
  let selectedTarget = applicationTargets[0];
  if (target) {
    if (!applicationTargets.includes(target)) {
      _cliTools().logger.info(`Target ${_picocolors().default.bold(target)} not found for scheme ${_picocolors().default.bold(scheme)}, automatically selected target ${_picocolors().default.bold(selectedTarget)}`);
    } else {
      selectedTarget = target;
    }
  }
  const targetIndex = applicationTargets.indexOf(selectedTarget);
  return settings[targetIndex].buildSettings;
}
function getPlatformName(buildOutput) {
  // Xcode can sometimes escape `=` with a backslash or put the value in quotes
  const platformNameMatch = /export PLATFORM_NAME\\?="?(\w+)"?$/m.exec(buildOutput);
  if (!platformNameMatch) {
    throw new (_cliTools().CLIError)('Couldn\'t find "PLATFORM_NAME" variable in xcodebuild output. Please report this issue and run your project with Xcode instead.');
  }
  return platformNameMatch[1];
}

//# sourceMappingURL=getBuildSettings.js.map