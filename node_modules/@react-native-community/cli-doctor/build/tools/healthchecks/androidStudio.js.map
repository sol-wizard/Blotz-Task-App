{"version":3,"file":"androidStudio.js","names":["label","description","getDiagnostics","IDEs","needsToBeFixed","missing","version","process","platform","archSuffix","arch","primaryAndroidStudioPath","join","getUserAndroidPath","replace","stdout","executeCommand","trim","altBase","env","LOCALAPPDATA","fallbackPath","win32AutomaticFix","loader","androidStudioUrl","installPath","downloadAndUnzip","downloadUrl","component","binFolder","createShortcut","path","name","ico","succeed","runAutomaticFix","logManualInstallation","fail","healthcheck","url","link","docs","hash","guide"],"sources":["../../../src/tools/healthchecks/androidStudio.ts"],"sourcesContent":["import {join} from 'path';\n\nimport {link} from '@react-native-community/cli-tools';\n\nimport {HealthCheckInterface} from '../../types';\n\nimport {downloadAndUnzip} from '../downloadAndUnzip';\nimport {executeCommand} from '../windows/executeWinCommand';\nimport {getUserAndroidPath} from '../windows/androidWinHelpers';\nimport {createShortcut} from '../windows/create-shortcut';\n\nexport default {\n  label: 'Android Studio',\n  description: 'Required for building and installing your app on Android',\n  getDiagnostics: async ({IDEs}) => {\n    const needsToBeFixed = IDEs['Android Studio'] === 'Not Found';\n\n    const missing = {\n      needsToBeFixed,\n      version: IDEs['Android Studio'],\n    };\n\n    // On Windows `doctor` installs Android Studio locally in a well-known place\n    if (needsToBeFixed && process.platform === 'win32') {\n      const archSuffix = process.arch === 'x64' ? '64' : '';\n\n      // Check if Android Studio is installed in one of its default locations\n      const primaryAndroidStudioPath = join(\n        getUserAndroidPath(),\n        'android-studio',\n        'bin',\n        `studio${archSuffix}.exe`,\n      ).replace(/\\\\/g, '\\\\\\\\');\n      const {stdout} = await executeCommand(\n        `wmic datafile where name=\"${primaryAndroidStudioPath}\" get Version`,\n      );\n      let version = stdout.replace(/(\\r\\n|\\n|\\r)/gm, '').trim();\n\n      if (version !== '') {\n        return {\n          needsToBeFixed: false,\n          version,\n        };\n      }\n\n      // 2) fallback path under %LOCALAPPDATA%\\Programs\\Android Studio\n      // This is the path used by the JetBrains Toolbox / Android Studio installer\n      const altBase = process.env.LOCALAPPDATA || '';\n      const fallbackPath = join(\n        altBase,\n        'Programs',\n        'Android Studio',\n        'bin',\n        `studio${archSuffix}.exe`,\n      ).replace(/\\\\/g, '\\\\\\\\');\n      try {\n        const {stdout} = await executeCommand(\n          `wmic datafile where name=\"${fallbackPath}\" get Version`,\n        );\n        version = stdout.replace(/(\\r\\n|\\n|\\r)/gm, '').trim();\n      } catch {\n        version = '';\n      }\n\n      if (version === '') {\n        return missing;\n      }\n\n      return {\n        needsToBeFixed: false,\n        version,\n      };\n    }\n\n    return missing;\n  },\n  win32AutomaticFix: async ({loader}) => {\n    // Need a GitHub action to update automatically. See #1180\n    const androidStudioUrl =\n      'https://redirector.gvt1.com/edgedl/android/studio/ide-zips/2022.3.1.18/android-studio-2022.3.1.18-windows.zip';\n\n    const installPath = getUserAndroidPath();\n    await downloadAndUnzip({\n      loader,\n      downloadUrl: androidStudioUrl,\n      component: 'Android Studio',\n      installPath: installPath,\n    });\n\n    const archSuffix = process.arch === 'x64' ? '64' : '';\n    const binFolder = join(installPath, 'android-studio', 'bin');\n\n    await createShortcut({\n      path: join(binFolder, `studio${archSuffix}.exe`),\n      name: 'Android Studio',\n      ico: join(binFolder, 'studio.ico'),\n    });\n\n    loader.succeed(\n      `Android Studio installed successfully in \"${installPath}\".`,\n    );\n  },\n  runAutomaticFix: async ({loader, logManualInstallation}) => {\n    loader.fail();\n\n    return logManualInstallation({\n      healthcheck: 'Android Studio',\n      url: link.docs('set-up-your-environment', 'android', {\n        hash: 'android-studio',\n        guide: 'native',\n      }),\n    });\n  },\n} as HealthCheckInterface;\n"],"mappings":";;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAIA;AACA;AACA;AACA;AAA0D,eAE3C;EACbA,KAAK,EAAE,gBAAgB;EACvBC,WAAW,EAAE,0DAA0D;EACvEC,cAAc,EAAE,OAAO;IAACC;EAAI,CAAC,KAAK;IAChC,MAAMC,cAAc,GAAGD,IAAI,CAAC,gBAAgB,CAAC,KAAK,WAAW;IAE7D,MAAME,OAAO,GAAG;MACdD,cAAc;MACdE,OAAO,EAAEH,IAAI,CAAC,gBAAgB;IAChC,CAAC;;IAED;IACA,IAAIC,cAAc,IAAIG,OAAO,CAACC,QAAQ,KAAK,OAAO,EAAE;MAClD,MAAMC,UAAU,GAAGF,OAAO,CAACG,IAAI,KAAK,KAAK,GAAG,IAAI,GAAG,EAAE;;MAErD;MACA,MAAMC,wBAAwB,GAAG,IAAAC,YAAI,EACnC,IAAAC,qCAAkB,GAAE,EACpB,gBAAgB,EAChB,KAAK,EACJ,SAAQJ,UAAW,MAAK,CAC1B,CAACK,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC;MACxB,MAAM;QAACC;MAAM,CAAC,GAAG,MAAM,IAAAC,iCAAc,EAClC,6BAA4BL,wBAAyB,eAAc,CACrE;MACD,IAAIL,OAAO,GAAGS,MAAM,CAACD,OAAO,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAACG,IAAI,EAAE;MAEzD,IAAIX,OAAO,KAAK,EAAE,EAAE;QAClB,OAAO;UACLF,cAAc,EAAE,KAAK;UACrBE;QACF,CAAC;MACH;;MAEA;MACA;MACA,MAAMY,OAAO,GAAGX,OAAO,CAACY,GAAG,CAACC,YAAY,IAAI,EAAE;MAC9C,MAAMC,YAAY,GAAG,IAAAT,YAAI,EACvBM,OAAO,EACP,UAAU,EACV,gBAAgB,EAChB,KAAK,EACJ,SAAQT,UAAW,MAAK,CAC1B,CAACK,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC;MACxB,IAAI;QACF,MAAM;UAACC;QAAM,CAAC,GAAG,MAAM,IAAAC,iCAAc,EAClC,6BAA4BK,YAAa,eAAc,CACzD;QACDf,OAAO,GAAGS,MAAM,CAACD,OAAO,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAACG,IAAI,EAAE;MACvD,CAAC,CAAC,MAAM;QACNX,OAAO,GAAG,EAAE;MACd;MAEA,IAAIA,OAAO,KAAK,EAAE,EAAE;QAClB,OAAOD,OAAO;MAChB;MAEA,OAAO;QACLD,cAAc,EAAE,KAAK;QACrBE;MACF,CAAC;IACH;IAEA,OAAOD,OAAO;EAChB,CAAC;EACDiB,iBAAiB,EAAE,OAAO;IAACC;EAAM,CAAC,KAAK;IACrC;IACA,MAAMC,gBAAgB,GACpB,+GAA+G;IAEjH,MAAMC,WAAW,GAAG,IAAAZ,qCAAkB,GAAE;IACxC,MAAM,IAAAa,kCAAgB,EAAC;MACrBH,MAAM;MACNI,WAAW,EAAEH,gBAAgB;MAC7BI,SAAS,EAAE,gBAAgB;MAC3BH,WAAW,EAAEA;IACf,CAAC,CAAC;IAEF,MAAMhB,UAAU,GAAGF,OAAO,CAACG,IAAI,KAAK,KAAK,GAAG,IAAI,GAAG,EAAE;IACrD,MAAMmB,SAAS,GAAG,IAAAjB,YAAI,EAACa,WAAW,EAAE,gBAAgB,EAAE,KAAK,CAAC;IAE5D,MAAM,IAAAK,8BAAc,EAAC;MACnBC,IAAI,EAAE,IAAAnB,YAAI,EAACiB,SAAS,EAAG,SAAQpB,UAAW,MAAK,CAAC;MAChDuB,IAAI,EAAE,gBAAgB;MACtBC,GAAG,EAAE,IAAArB,YAAI,EAACiB,SAAS,EAAE,YAAY;IACnC,CAAC,CAAC;IAEFN,MAAM,CAACW,OAAO,CACX,6CAA4CT,WAAY,IAAG,CAC7D;EACH,CAAC;EACDU,eAAe,EAAE,OAAO;IAACZ,MAAM;IAAEa;EAAqB,CAAC,KAAK;IAC1Db,MAAM,CAACc,IAAI,EAAE;IAEb,OAAOD,qBAAqB,CAAC;MAC3BE,WAAW,EAAE,gBAAgB;MAC7BC,GAAG,EAAEC,gBAAI,CAACC,IAAI,CAAC,yBAAyB,EAAE,SAAS,EAAE;QACnDC,IAAI,EAAE,gBAAgB;QACtBC,KAAK,EAAE;MACT,CAAC;IACH,CAAC,CAAC;EACJ;AACF,CAAC;AAAA"}